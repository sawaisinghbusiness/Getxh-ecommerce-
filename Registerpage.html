<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>GETXH - Register</title>

<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>

<style>
.material-symbols-outlined {
    font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 20;
    font-size:20px;
}
.form-input-container { position: relative; }
.form-input-container .material-symbols-outlined {
    position:absolute; left:1rem; top:50%; transform:translateY(-50%);
    color:#D1D5DB; pointer-events:none;
}
.form-input-container .form-input { padding-left:3rem; }
.toggle-password {
    position:absolute; right:1rem; top:50%; transform:translateY(-50%);
    color:#D1D5DB; cursor:pointer;
}
.toggle-password:hover { color:#111827; }
.toggle-password .material-symbols-outlined { pointer-events:auto; }
</style>
</head>

<body class="font-display bg-white">

<div class="min-h-screen flex items-center justify-center px-4">

<div class="w-full max-w-md bg-white p-8 rounded-xl shadow-[0_4px_24px_rgba(209,213,219,0.3)]">

<h2 class="text-3xl font-bold text-center mb-6 text-[#111827]">Create Account</h2>

<div id="errorBox" class="hidden text-red-600 text-center mb-4 font-medium"></div>

<!-- NAME -->
<div class="flex flex-col mb-4">
<label class="text-sm font-medium text-[#111827] mb-2">Full Name</label>
<div class="form-input-container">
<input id="name" type="text" class="form-input w-full rounded-lg border border-[#D1D5DB] h-12 px-4" placeholder="Your name"/>
<span class="material-symbols-outlined">person</span>
</div>
</div>

<!-- EMAIL -->
<div class="flex flex-col mb-4">
<label class="text-sm font-medium text-[#111827] mb-2">Email</label>
<div class="form-input-container">
<input id="email" type="email" class="form-input w-full rounded-lg border border-[#D1D5DB] h-12 px-4" placeholder="you@example.com"/>
<span class="material-symbols-outlined">mail</span>
</div>
</div>

<!-- PASSWORD -->
<div class="flex flex-col mb-4">
<label class="text-sm font-medium text-[#111827] mb-2">Password</label>
<div class="form-input-container">
<input id="password" type="password" class="form-input w-full rounded-lg border border-[#D1D5DB] h-12 px-4" placeholder="Create password"/>
<span class="material-symbols-outlined">lock</span>
<div class="toggle-password" onclick="togglePass('password')">
<span class="material-symbols-outlined">visibility</span>
</div>
</div>
</div>

<!-- CONFIRM PASSWORD -->
<div class="flex flex-col mb-6">
<label class="text-sm font-medium text-[#111827] mb-2">Confirm Password</label>
<div class="form-input-container">
<input id="confirmPassword" type="password" class="form-input w-full rounded-lg border border-[#D1D5DB] h-12 px-4" placeholder="Re-enter password"/>
<span class="material-symbols-outlined">lock</span>
<div class="toggle-password" onclick="togglePass('confirmPassword')">
<span class="material-symbols-outlined">visibility</span>
</div>
</div>
</div>

<!-- REGISTER BUTTON -->
<button id="registerBtn" class="w-full h-12 bg-[#0052FF] text-white font-semibold rounded-lg hover:bg-[#0045d6]">
Register
</button>

<!-- FOOTER -->
<div class="text-center mt-6">
<a href="index.html" class="text-sm text-[#111827]">
Already have an account? <span class="text-[#0052FF] font-semibold">Login</span>
</a>
</div>

</div>
</div>

<!-- ⭐ Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyClO8clBVgSHKx8jarNwC38oMtWRK0W8KE",
  authDomain: "getxh-42588.firebaseapp.com",
  projectId: "getxh-42588",
  storageBucket: "getxh-42588.firebasestorage.app",
  messagingSenderId: "170770122888",
  appId: "1:170770122888:web:7adcf91077d5695b06b73d"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

document.getElementById("registerBtn").onclick = async function () {

    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const pass = document.getElementById("password").value.trim();
    const cpass = document.getElementById("confirmPassword").value.trim();
    const errorBox = document.getElementById("errorBox");

    if (!name) return show("Name cannot be empty");
    if (!email) return show("Email cannot be empty");
    if (!email.includes("@")) return show("Enter a valid email");
    if (pass.length < 6) return show("Password must be at least 6 characters");
    if (pass !== cpass) return show("Passwords do not match");

    try {
        const userCred = await createUserWithEmailAndPassword(auth, email, pass);

        await updateProfile(userCred.user, { displayName: name });

        await setDoc(doc(db, "Users", userCred.user.uid), {
            Name: name,
            Email: email,
            TotalOrders: 0,
            Balance: 0,
            TotalSpent: 0
        });

        // ✅ SESSION SAVE
        localStorage.setItem("getxh_user_logged_in", "yes");
        localStorage.setItem("getxh_current_user", email);
        localStorage.setItem("getxh_user_name", name);

        // ✅ DIRECT DASHBOARD
        window.location.href = "Dashboard.html";
    }
    catch (error) {
        let msg = "Something went wrong. Try again.";

        if (error.code === "auth/email-already-in-use") {
            msg = "Email already registered. Please login.";
        } else if (error.code === "auth/weak-password") {
            msg = "Password must be at least 6 characters.";
        } else if (error.code === "auth/invalid-email") {
            msg = "Enter a valid email address.";
        }

        errorBox.textContent = msg;
        errorBox.classList.remove("hidden");
    }
};

function show(msg){
    const box = document.getElementById("errorBox");
    box.textContent = msg;
    box.classList.remove("hidden");
}
</script>

<script>
function togglePass(id){
    const i = document.getElementById(id);
    i.type = i.type === "password" ? "text" : "password";
}
</script>

</body>
</html>
